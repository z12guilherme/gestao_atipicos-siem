# logstash/pipeline/vercel.conf
input {
  http {
    host => "0.0.0.0"
    port => 8080
    codec => "json_lines"
    # Futuramente, adicionaremos segurança aqui com um token
  }
}

filter {
  # Adiciona geolocalização baseada no IP do cliente
  geoip {
    source => "[proxy][clientIp]"
    target => "geoip"
    # O campo [proxy][clientIp] vem da estrutura de log da Vercel
  }
  # Converte o timestamp da Vercel para o formato correto
  date {
    match => [ "timestamp", "UNIX_MS" ]
  }
}

output {
  # Envia para o Elasticsearch que está rodando no mesmo Docker Compose
  elasticsearch {
    hosts => ["http://elasticsearch:9200"]
    index => "vercel-gemini-%{+YYYY.MM.dd}"
  }
  # Adiciona uma saída para o console para fins de depuração
  stdout {
    codec => rubydebug
  }
}